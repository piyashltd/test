<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MikroTik User Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.07);
        }
        .animate-fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }
        .animate-slide-up {
            animation: slideUp 0.5s ease-out forwards;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .gradient-text {
            background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100 p-4">

    <!-- Config Configuration -->
    <script>
        // CONFIGURATION
        // Set this to false when you have the Node.js backend running
        const USE_MOCK_API = true; 
        const API_URL = 'http://localhost:3000'; 
    </script>

    <!-- Login Container -->
    <div id="login-container" class="w-full max-w-md animate-slide-up">
        <div class="glass-panel rounded-2xl p-8 shadow-xl">
            <div class="text-center mb-8">
                <div class="w-16 h-16 bg-blue-600 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg shadow-blue-600/20">
                    <i class="fa-solid fa-wifi text-white text-2xl"></i>
                </div>
                <h1 class="text-2xl font-bold text-gray-800">Welcome Back</h1>
                <p class="text-gray-500 mt-2 text-sm">Sign in to view your network usage</p>
            </div>

            <form id="login-form" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Username</label>
                    <div class="relative">
                        <span class="absolute left-3 top-3 text-gray-400">
                            <i class="fa-solid fa-user"></i>
                        </span>
                        <input type="text" id="username" required
                            class="w-full pl-10 pr-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all"
                            placeholder="Enter your username">
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                    <div class="relative">
                        <span class="absolute left-3 top-3 text-gray-400">
                            <i class="fa-solid fa-lock"></i>
                        </span>
                        <input type="password" id="password" required
                            class="w-full pl-10 pr-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all"
                            placeholder="••••••••">
                    </div>
                </div>

                <div id="login-error" class="hidden p-3 bg-red-50 text-red-600 text-sm rounded-lg border border-red-100 flex items-center">
                    <i class="fa-solid fa-circle-exclamation mr-2"></i>
                    <span id="error-text">Authentication failed</span>
                </div>

                <button type="submit" id="login-btn"
                    class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-xl transition-all shadow-lg shadow-blue-600/30 flex items-center justify-center space-x-2">
                    <span>Sign In</span>
                    <i class="fa-solid fa-arrow-right text-sm"></i>
                </button>
            </form>
            
            <div class="mt-6 text-center">
                <p class="text-xs text-gray-400">
                    <span id="connection-status" class="inline-flex items-center">
                        <span class="w-2 h-2 rounded-full bg-green-400 mr-1"></span>
                        System Online
                    </span>
                </p>
            </div>
        </div>
    </div>

    <!-- Dashboard Container (Hidden by default) -->
    <div id="dashboard-container" class="hidden w-full max-w-4xl animate-fade-in">
        <!-- Header -->
        <div class="flex flex-col md:flex-row justify-between items-center mb-8 glass-panel p-6 rounded-2xl">
            <div class="flex items-center space-x-4 mb-4 md:mb-0">
                <div class="w-12 h-12 bg-indigo-100 text-indigo-600 rounded-full flex items-center justify-center">
                    <i class="fa-solid fa-user-circle text-2xl"></i>
                </div>
                <div>
                    <h2 class="text-xl font-bold text-gray-800" id="user-greeting">Hello, User</h2>
                    <p class="text-sm text-gray-500 flex items-center">
                        <i class="fa-solid fa-circle text-[8px] text-green-500 mr-2"></i>
                        Active Session
                    </p>
                </div>
            </div>
            <button onclick="handleLogout()" class="px-6 py-2 bg-red-50 text-red-600 hover:bg-red-100 rounded-lg transition-colors text-sm font-medium">
                <i class="fa-solid fa-right-from-bracket mr-2"></i> Logout
            </button>
        </div>

        <!-- Stats Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <!-- Download Card -->
            <div class="glass-panel p-6 rounded-2xl relative overflow-hidden group">
                <div class="absolute right-0 top-0 w-32 h-32 bg-green-500/10 rounded-bl-full -mr-8 -mt-8 transition-all group-hover:scale-110"></div>
                <div class="relative z-10">
                    <div class="flex justify-between items-start mb-4">
                        <div class="p-3 bg-green-100 text-green-600 rounded-xl">
                            <i class="fa-solid fa-download text-xl"></i>
                        </div>
                        <span class="text-xs font-semibold bg-green-50 text-green-600 px-2 py-1 rounded">RECEIVED</span>
                    </div>
                    <h3 class="text-3xl font-bold text-gray-800 mb-1" id="download-display">0 MB</h3>
                    <p class="text-sm text-gray-500">Total Data Downloaded</p>
                </div>
            </div>

            <!-- Upload Card -->
            <div class="glass-panel p-6 rounded-2xl relative overflow-hidden group">
                <div class="absolute right-0 top-0 w-32 h-32 bg-blue-500/10 rounded-bl-full -mr-8 -mt-8 transition-all group-hover:scale-110"></div>
                <div class="relative z-10">
                    <div class="flex justify-between items-start mb-4">
                        <div class="p-3 bg-blue-100 text-blue-600 rounded-xl">
                            <i class="fa-solid fa-upload text-xl"></i>
                        </div>
                        <span class="text-xs font-semibold bg-blue-50 text-blue-600 px-2 py-1 rounded">SENT</span>
                    </div>
                    <h3 class="text-3xl font-bold text-gray-800 mb-1" id="upload-display">0 MB</h3>
                    <p class="text-sm text-gray-500">Total Data Uploaded</p>
                </div>
            </div>
        </div>

        <!-- Usage Chart Section -->
        <div class="glass-panel p-6 rounded-2xl">
            <div class="flex justify-between items-center mb-6">
                <h3 class="font-bold text-gray-800">Session Overview</h3>
                <button onclick="fetchDataUsage()" class="text-blue-600 hover:text-blue-700 text-sm flex items-center">
                    <i class="fa-solid fa-rotate-right mr-1"></i> Refresh
                </button>
            </div>
            <div class="h-64 w-full">
                <canvas id="usageChart"></canvas>
            </div>
        </div>
    </div>

    <script>
        // State
        let currentUser = null;
        let chartInstance = null;

        // Elements
        const loginContainer = document.getElementById('login-container');
        const dashboardContainer = document.getElementById('dashboard-container');
        const loginForm = document.getElementById('login-form');
        const errorDiv = document.getElementById('login-error');
        const errorText = document.getElementById('error-text');
        const loginBtn = document.getElementById('login-btn');

        // Helper: Format Bytes
        function formatBytes(bytes, decimals = 2) {
            if (!+bytes) return '0 Bytes';
            const k = 1024;
            const dm = decimals < 0 ? 0 : decimals;
            const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return `${parseFloat((bytes / Math.pow(k, i)).toFixed(dm))} ${sizes[i]}`;
        }

        // Initialize Chart
        function initChart() {
            const ctx = document.getElementById('usageChart').getContext('2d');
            chartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Received (Download)', 'Sent (Upload)'],
                    datasets: [{
                        label: 'Data Usage',
                        data: [0, 0],
                        backgroundColor: [
                            'rgba(34, 197, 94, 0.6)', // Green for Download
                            'rgba(59, 130, 246, 0.6)'  // Blue for Upload
                        ],
                        borderColor: [
                            'rgb(34, 197, 94)',
                            'rgb(59, 130, 246)'
                        ],
                        borderWidth: 1,
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatBytes(value); // Use helper to format axis
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: { display: false }
                    }
                }
            });
        }

        // Login Handler
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            setLoading(true);
            errorDiv.classList.add('hidden');

            try {
                let response;
                
                if (USE_MOCK_API) {
                    // SIMULATE API CALL
                    await new Promise(r => setTimeout(r, 1500)); // Fake network delay
                    if (username.length > 2) {
                        response = { success: true, user: username };
                    } else {
                        throw new Error("Invalid credentials (Mock)");
                    }
                } else {
                    // REAL API CALL
                    const res = await fetch(`${API_URL}/login`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ username, password })
                    });
                    response = await res.json();
                    if (!response.success) throw new Error(response.message);
                }

                // Success
                currentUser = response.user;
                showDashboard();
                fetchDataUsage();

            } catch (err) {
                errorDiv.classList.remove('hidden');
                errorText.textContent = err.message || 'Connection failed';
            } finally {
                setLoading(false);
            }
        });

        // Fetch Data Usage
        async function fetchDataUsage() {
            if (!currentUser) return;

            try {
                let data;
                
                if (USE_MOCK_API) {
                    // MOCK DATA GENERATOR
                    const randomDown = Math.floor(Math.random() * 5000000000) + 100000000; // 100MB - 5GB
                    const randomUp = Math.floor(Math.random() * 1000000000) + 50000000;   // 50MB - 1GB
                    data = { bytesIn: randomDown, bytesOut: randomUp };
                } else {
                    // REAL API CALL
                    const res = await fetch(`${API_URL}/stats?user=${encodeURIComponent(currentUser)}`);
                    const json = await res.json();
                    data = { bytesIn: parseInt(json.bytesIn), bytesOut: parseInt(json.bytesOut) };
                }

                updateUI(data);

            } catch (err) {
                console.error("Failed to fetch stats", err);
            }
        }

        function updateUI(data) {
            // Update Text
            document.getElementById('download-display').textContent = formatBytes(data.bytesIn);
            document.getElementById('upload-display').textContent = formatBytes(data.bytesOut);

            // Update Chart
            if (chartInstance) {
                chartInstance.data.datasets[0].data = [data.bytesIn, data.bytesOut];
                chartInstance.update();
            }
        }

        function showDashboard() {
            loginContainer.classList.add('hidden');
            dashboardContainer.classList.remove('hidden');
            document.getElementById('user-greeting').textContent = `Hello, ${currentUser}`;
            
            // Init chart if not already
            if (!chartInstance) setTimeout(initChart, 100);
        }

        function handleLogout() {
            currentUser = null;
            dashboardContainer.classList.add('hidden');
            loginContainer.classList.remove('hidden');
            loginForm.reset();
        }

        function setLoading(isLoading) {
            const btn = document.getElementById('login-btn');
            if (isLoading) {
                btn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin"></i><span>Verifying...</span>';
                btn.disabled = true;
                btn.classList.add('opacity-75');
            } else {
                btn.innerHTML = '<span>Sign In</span><i class="fa-solid fa-arrow-right text-sm"></i>';
                btn.disabled = false;
                btn.classList.remove('opacity-75');
            }
        }
    </script>
</body>
</html>

